# WEB-31-Yudin-highload
Курсовая работа по highload

Студент: Юдин Данила Антонович  
Группа: WEB-31 (осень 2025)  
Старший преподаватель: Александр Быков  

# TikTok
## 1. Выбор тематики и аудитории
**Тип сервиса**: Социальные медиа, видеохостинг, развлекательный сервис  
**Основные регионы**: США (135.79M), Индонезия (107.69M), Бразилия (91.75M), Россия (55.98M) [^1]  
**Количество зарегистрированных пользователей**: 2.249B [^2]  
**Расположение дата-центров**: США, Ирландия, Норвегия, Сингапур, Малайзия [^3]  
**Основной функционал MVP**:
1. Посмотреть видео-ролик
2. Поставить лайк/дизлайк
3. Подписаться на канал/добавить в избранное
4. Выложить ролик на свой канал
5. Написать комментарий
6. Система рекоммендаций на основе распознования настроения и удержании внимания  
**Дополнительный функционал**:  
7. Поиск ролика/аккаунта по ключевому слову (+фильтры)  
8. Система продвижения (поделиться/не рекоммендовать)  
9. Технология Duet & Stitch

**Особенности**:
1. Короткий формат видео-роликов
2. Система рекомендаций, заточенная на удержание внимания
3. Технология Duet & Stitch
4. Низкий порог входа

**Отличие от других видеохостингов сервисов**:  
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Другие популярные видеохостинги, такие как Youtube позиционируется как поисковая/архивная видео-платформа со средней продолжительностей видео в 10-15 минут, нацеленная на широкую аудиторию и разнообразие жанров. В то время как TikTok предлагает преимущественно развлекательный контент длительностью ролика менее 60 секунд, нацеленная на молодежный сегмент.  
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Таким образом, Youtube - более универсальный сервис, который не имеет строго определенной аудитории, обладающим большим спектром возможностей - от обучения и развлечений до просмотра политических новостей, однако TikTok предлагает совершенно иной опыт - короткие развлекательные ролики, не требующие долгого фокуса и внимания, ориентированные на конкретные интересы и предпочтения.

**Конкуренция**:  
1. Youtube Shorts
2. Instagram Reels
3. Snapchat Spotlight

## 2. Расчет нагрузки

### Аудиторные метрики
Информация найдена в интернете. Все ссылки на источники будут расположены в конце РПЗ

| Метрика                                          | Значение      |
| ------------------------------------------------ | ------------- |
| MAU                                              | 1.582B [^4]   |
| DAU                                              | 875.736M [^5] |
| Количество зарегистрированных пользователей      | 2.249B [^2]   |
| Количество роликов выпускаемых в минуту          | 16000 [^8]    |

### Продуктовые метрики
Информация найдена путем личного эксперимента (кроме "средней продолжительности сессии"). Данные приблизительные и могут неточно отражать действительность.

| Метрика                                             | Значение       |
| --------------------------------------------------- | -------------- |
| Средняя продолжительность сессии                    | 53.8 мин [^6]  |
| Средняя продолжительность ролика                    | 42.7 сек [^11] |
| Среднее количество лайков/дизлайков на 1000 роликов | 34 [^10]       |
| Среднее количество подписок на 1000 роликов         | 1 [^10]        |
| Среднее количество комментариев на 1000 роликов     | 7  [^10]       |
| Среднее количество шейров на 1000 роликов           | 2  [^10]       |
| Среднее количество сохранений на 1000 роликов       | 5.6  [^13]     |
| Частота использования поисковой системы Тик Ток     | 73%  [^14]     |
| Частота использования технологии Duet/Stitch        | 19%  [^15]     |
| Среднее количество просмотров под роликом           | 32108  [^12]   |
| Bitrate                                             | 7.5 Mbps       |

### Технические метрики
&nbsp;&nbsp;&nbsp;&nbsp;В качестве вводных был произведен расчет среднего количества просмотренных роликов одним пользователем в день (Предполагается, что пользователь на протяжении всей сессии только смотрел ролики), вес одного средне-статистического ролика и комментариев под ним:  


**Просмотров в день на одного пользователя**: &nbsp;&nbsp;
$\frac{\text{Продолжительность сессии}}{\text{Продолжительность ролика}} = \frac{53.8 \text{ мин}}{27.5 \text{ сек}} = \frac{3228 \text{ сек}}{27.5 \text{ сек}} \approx 76$  &nbsp;&nbsp;&nbsp;&nbsp;             **(1)**  
**Вес одного среднего по продолжительности ролика**:  &nbsp;&nbsp;
$\text{Вес ролика} = \text{Битрейт} \times \text{Продолжительность} = ( \frac{7.5}{8} ) \times 42.7 \approx 40 \text{ MB}$ &nbsp;&nbsp;&nbsp;&nbsp; **(2)**
**Среднее количество комментариев под роликом**:  &nbsp;&nbsp;
$\text{Среднее количество просмотров} \times \text{Вероятность коммментария} \approx 225 \text{ шт}$ &nbsp;&nbsp;&nbsp;&nbsp; **(3)**


### Хранилище


&nbsp;&nbsp;&nbsp;&nbsp;Для того, чтобы понять какой объем данных содержится на сервере на одного пользователя и общее количество информации необходимо узнать сколько роликов выходят на одного пользователя. По данным stata известно, что каждую минуту выходит 16000 роликов в минуту. Пересчитав это на день и поделив на DAU - станет явным, сколько роликов приходится на одного пользователя в день. Данный показатель является скоростью загрузки контента. Можно считать данную метрику постоянной, так как отражает лишь заинтресованность пользователя в развитии своего канала. Таким образом можно будет узнать сколько роликов было выпушено за все время на одного пользователя и каков этот объем данных:

**Количество новых роликов в день**:&nbsp;&nbsp;
$\text{Количество роликов в минуту} \times \text{Количество минут в дне} = 16000 \times 1440 \approx 23.04 \text{ млн}$&nbsp;&nbsp;&nbsp;&nbsp; **(4)**  
**Количество роликов на одного пользователя в день**:&nbsp;&nbsp;
$\frac{\text{Количество роликов в день}}{\text{DAU}} = \frac{23.04}{875.736} = 0.026$ &nbsp;&nbsp;&nbsp;&nbsp;**(5)**  
**Количество сохранений на одного пользователя в день**:&nbsp;&nbsp;**(6)**  
$\text{Количество роликов в день} \times \text{Вероятность сохранения} = 76 \times 0.002 = 0.152$  
**Количество сохранений на одного пользователя**:&nbsp;&nbsp;
$\text{Количество сохранений в день} \times \text{Среднее количество дней сущестования} = 0.152 \times 1643 = 249$ &nbsp;&nbsp;&nbsp;&nbsp;**(7)**  


| Год  | MAU          | Uploads    |
|------|--------------|------------|
| 2018 | 133 млн      | 1.27 млрд  |
| 2019 | 381 млн      | 3.63 млрд  |
| 2020 | 700 млн      | 6.67 млрд  |
| 2021 | 902 млн      | 8.6 млрд   |
| 2022 | 1,366 млрд   | 13.02 млрд |
| 2023 | 1,587 млрд   | 15.12 млрд |
| 2024 | 1,685 млрд   | 16.05 млрд |
| 2025 | 1.582 млрд   | 11.81 млрд |
| ***Итог***|         | ***76.7 млрд***|


**Средний размер хранилища пользователя (видео)**:&nbsp;&nbsp;
$\frac{\text{Количество роликов за все время}}{\text{Количество зарегистрированных}} = \frac{76.7}{2.249} \approx 34.1\text{ шт}$&nbsp;&nbsp;&nbsp;&nbsp; **(8)**  
**Общее количество комментариев под всеми роликами**:&nbsp;&nbsp;
$\text{Средний размер хранилища пользователя} \times \text{Кол-во комментариев} = 34.1 \times 225 \approx 7875\text{ шт}$&nbsp;&nbsp;&nbsp;&nbsp; **(9)**  
**Вес комментариев под всеми роликами**:&nbsp;&nbsp;
$\text{Среднее количество символов в комментарии} \times \text{кодировка UTF-8} \times \text{Количество комментариев} = 50 \times 1 \times 7875 = 384.5 \text{ KB}$$&nbsp;&nbsp;&nbsp;&nbsp; **(10)**  
**Средний размер хранилища пользователя (ГБ)**:&nbsp;&nbsp;  
$\text{Средний размер хранилища пользователя} \times \text{Вес ролика} = 34.1 \times 40 = 1.36\text{ GB}$&nbsp;&nbsp;&nbsp;&nbsp; **(11)**

&nbsp;&nbsp;&nbsp;&nbsp;Каждый пользователь имеет аватарку размерами либо 100х100, либо 200х200 пикселей в формате jpeg или png. Изображения с хорошей глубиной цвета такого размера в данных форматах весят около 20 килобайт. Мета-данные представляют собой название канала, его тег и 3 счетчика: количество подписчиков, количество подписок и количестов лайков. Название и тег весят в кодировке UTF-8 около 16 байт, а каждый счетчик по 8 байт.


| Тип данных  | Количество             | Хранилище пользователя    | Хранилище общее |
|-------------|------------------------|---------------------------|-----------------|
| Аватарка    | 1                      | 20 KB                     | 41.89 TB        |
| Мета-данные | 16 + 16 + 8*3 символов | 56 B                      | 117.29 GB       |
| Ролики      | 35                     | 1.36 GB                   | 2917 PB         |
| Комментарии | 385                    | 384.5 KB                  | 806.35 TB       |
| Сохраненки  | 249                    | 4.86 MB                   | 10.19 PB        |
| ***Итог***  |                        | ***1.365 GB***            | ***2929 PB***   |


### RPS


&nbsp;&nbsp;&nbsp;&nbsp;Очередным этапом стала оценка количества запросов на чтение и запись в день. Для этого были умножены следующие метрики: количество активных пользователей в день, количество просмотров в день на одного пользователя и вероятность на 1000 роликов лайков/дизлайков, подписок, комментариев.  

**Количество лайков в день**:&nbsp;&nbsp;
$\text{DAU} \times \text{Просмотров на пользователя} \times \text{Вероятность лайка} = 875.736 \times 10^6 \times 76 \times 0.034 \approx 2.263 \text{ млрд}$&nbsp;&nbsp;&nbsp;&nbsp; **(12)**  
**Количество комментов в день**:   
$\text{DAU} \times \text{Просмотров на пользователя} \times \text{Вероятность коммента} = 875.736 \times 10^6 \times 76 \times 0.007 \approx 465.9 \text{ млн}$$&nbsp;&nbsp;&nbsp;&nbsp; **(13)**  
**Количество подписок в день**:   
$\text{DAU} \times \text{Просмотров на пользователя} \times \text{Вероятность подписок} = 875.736 \times 10^6 \times 76 \times 0.001 \approx 66.56 \text{ млн}$&nbsp;&nbsp;&nbsp;&nbsp; **(14)**  
**Количество регистраций в день**:   
$\frac{\text{Количество скачиваний в год}}{\text{Количество дней в году}} = \frac{875.67 \times 10^6}{365} \approx 2.4 \text{ млн}$&nbsp;&nbsp;&nbsp;&nbsp; **(15)**  
**Количество шейров в день**:   
$\text{DAU} \times \text{Просмотров на пользователя} \times \text{Вероятность шейра} = 875.736 \times 10^6 \times 76 \times 0.002 \approx 133.102 \text{ млн}$&nbsp;&nbsp;&nbsp;&nbsp; **(16)**  
**Количество сохранений в день**:   
$\text{DAU} \times \text{Просмотров на пользователя} \times \text{Вероятность сохранения} = 875.736 \times 10^6 \times 76 \times 0.0056 \approx 372.714 \text{ млн}$&nbsp;&nbsp;&nbsp;&nbsp; **(17)**  
**Количество поисков в день**:   
$\text{DAU} \times \text{Вероятность поиска} = 875.736 \times 10^6 \times 0.73 \approx 639.287 \text{ млн}$&nbsp;&nbsp;&nbsp;&nbsp; **(18)**  
**Количество загрузок с Duet/Stitch в день**:   
$\text{Количество загрузок} \times \text{19%} = 23.04 \times 10^6 \times 0.19 \approx 4.378 \text{ млн}$&nbsp;&nbsp;&nbsp;&nbsp; **(19)**  

 
&nbsp;&nbsp;&nbsp;&nbsp;Заключительным этапом расчета технических метрик стало нахождение среднего и пикового RPS на чтение и запись. RPS на чтение определен из просмотров пользователя. Стоит принять во внимание, что ролики для просмотра грузятся одним стеком в 5 шт., а для расчета пикового RPS был взят коэффицент равный 2, так как сервера Tik Tok распределенны территориально по всему миру, к тому же наибольшее количество пользователей из стран Америки, Азии и Африки. Их часовые пояса сильно отличаются и пики посещаемости равномерно распологаются по 24 часам дня. Из-за чего пик неявно отражен:


**Количество запросов в день на просмотр роликов (RPD)**:&nbsp;&nbsp;  
$$\text{DAU} \times \text{Просмотров на пользователя} = 875.736 \times 10^6 \times 76 \approx 66.556 \text{ млрд}$$&nbsp;&nbsp;&nbsp;&nbsp; **(20)**   

**Средний RPS на чтение**:&nbsp;&nbsp;&nbsp;&nbsp;
$$\text{RPS}_{\text{avg}} = \frac{\text{RPD}}{86400 \text{ (секунд в дне)}} = \frac{66.556 \times 10^9}{86400} \approx 770324$$ &nbsp;&nbsp;  **(21)**  


|                      | Количество запросов в день | RPS среднее | RPS пиковое  |
|----------------------|----------------------------|-------------|--------------|
| Просмотр ролика      | 66.556 млрд                | 770324      | 1540648      |
| Выпуск ролика        | 23.04 млн                  | 267         | 534          |
| _Duet/Stitch_        | _4.378 млн_                | _51_        | _102_        |
| Лайк/дизлайк         | 2.263 млрд                 | 26193       | 52386        |
| Комментарий          | 465.9 млн                  | 5393        | 10786        |
| Подписка             | 66.56 млн                  | 771         | 1542         |
| Регистрация          | 2.4 млн                    | 28          | 56           |
| Поделиться           | 133.102 млн                | 1541        | 3082         |
| Добавить в избранное | 372.714 млн                | 4314        | 8628         |
| Поиск                | 639.287 млн                | 7400        | 14800        |
| ***Итог***           | ***70.513 млрд***          | ***816231***| ***1626607***|

### Трафик


&nbsp;&nbsp;&nbsp;&nbsp;Следующим шагом стал расчёт трафика. Для этого был высчитан трафик на каждое возможное действие MVP и перемножив его с RPS средним и пиковым - можно получить среднюю и пиковую нагрузку на сервер:  


|                             | Трафик на действие | Нагрузка            | Пиковая нагрузка |
|-----------------------------|--------------------|---------------------|------------------|
| Просмотр ролика             | 40 MB              | 29.38 TB/сек        |  58.76 TB/сек    |
| Выпуск ролика               | 40 MB              | 10.43 GB/сек        |  20.86 GB/сек    |
| Выпуск ролика c Duet/Stitch | 40 MB              | 1.99 GB/сек         |  3.98 GB/сек     |
| Лайк/дизлайк                | 0.5 KB             | 12.78 MB/сек        |  25.56 MB/сек    |
| Комментарий                 | 1 KB               | 5.27 MB/сек         |  10.54 MB/сек    |
| Подписка                    | 0.5 KB             | 385.5 KB/сек        |  771 KB/сек      |
| Регистрация                 | 2 KB               | 56 KB/сек           |  112 KB/сек      |
| Поделиться                  | 0.5 KB             | 771 KB/сек          |  1542 KB/сек     |
| Добавить в избранное        | 0.6 KB             | 2588 KB/сек         |  5179 KB/сек     |
| Поиск                       | 0.75 MB            | 5.42 GB/сек         |  10.84 GB/сек    |


## 3. Глобальная балансировка нагрузки


&nbsp;&nbsp;&nbsp;&nbsp;Для того чтобы определиться с количеством и расоложением дата-центров, необходимо проанализировать в первую очередь территориальную распределенность по странам, регионам и континентам. Эта информация поможет найти плотность пользователей на территории, и, как следствие - места с наименьшей задержкой и количеством хопов.  


| Страна    | Регион           | Количество зарегистрированных |
|-----------|------------------|----------|
| США       | Северная Америка | 136 млн  |
| Индонезия | Азия             | 108 млн  |
| Бразилия  | Южная Америка    | 91.7 млн |
| Мексика   | Северная Америка | 88.4 млн |
| Пакистан  | Азия             | 66.9 млн |
| Филиппины | Азия             | 62.3 млн |
| Россия    | Европа           | 56.0 млн |
| Бангладеш | Азия             | 46.5 млн |
| Египет    | Африка           | 41.3 млн |
| Вьетнам   | Азия             | 40.9 млн |


&nbsp;&nbsp;&nbsp;&nbsp;Для приоритизации и определения количества дата-центров был произведен расчет доли нагрузки на регион от общей. Допустим, что каждый дата-центр для безопасности будут одинаковой мощности и обладать одинаковым количеством серверов. Примем за лимит нагрузки на один дата-центр - 5+-1%, и из этого расчитаем количество дата-центров на регион.  


| Регион           | Доля от мирового | Распределение RPS | Количество ДЦ | Нагрузка на 1 ДЦ |
|------------------|------------------|-------------------|---------------|------------------|
| Азия             | 36%              | 289.072           | 7             | 41296 (5.14%)    |
| Северная Америка | 12%              | 96.358            | 3             | 32120 (4%)       |
| Южная Америка    | 10%              | 80.298            | 2             | 40129 (4.99%)    |
| Европа           | 10%              | 80.298            | 2             | 40129 (4.99%)    |
| Африка           | 11%              | 88.327            | 2             | 44163 (5.5%)     |


&nbsp;&nbsp;&nbsp;&nbsp;Чтобы найти наилучшее расположение дата-центров нужно проанализировать плотность активных пользователей интернета. Это позволит найти точки с наибольшим сосредаточением количества соединений.  


### Плотность активных пользователей интернета
![ada5651d8964f4a7d007f34bccbf17a5_cropped_1332x810](https://github.com/user-attachments/assets/59f295c9-1b40-4c62-ba60-9f670537d317)


&nbsp;&nbsp;&nbsp;&nbsp;Если узнать в каких странах сосредаточено наибольшее количество зарегистрированных пользователей Тик Тока, зная плотность пользователей всего интернета - можно определиться с расположением серверов.


### География регистраций (10 стран)
![Tik tok](https://github.com/user-attachments/assets/572f70bf-f2a0-47b0-8988-897eb102474c)


| Регион           | Страна расположения ДЦ | Административная единица ДЦ |
|------------------|------------------------|-----------------------------|
| Азия             | Индонезия              | Джакарта                    |
| Азия             | Вьетнам                | Ханой                       |
| Азия             | Сингапур               | Сингапур                    |
| Азия             | Япония                 | Токио                       |
| Азия             | Малайзия               | Джахор-Бару                 |
| Азия             | Китай                  | Гонконг                     |
| Азия             | Китай                  | Пекин                       |
| Северная Америка | США                    | Северная Вирджиния          |
| Северная Америка | США                    | Хилсборо                    |
| Северная Америка | Мексика                | Мехико                      |
| Южная Америка    | Бразилия               | Сан-Паулу                   |
| Южная Америка    | Аргентина              | Буэнос-Айрес                |
| Европа           | Ирландия               | Дублин                      |
| Европа           | Норвегия               | Хамар                       |
| Африка           | ЮАР                    | Йоханнесбург                |
| Европа           | Турция                 | Стамбул                     |


### Расположение дата-центров Тик Тока
![Main](https://github.com/user-attachments/assets/96890218-5978-4d84-a171-cfbceb83d232)


### Схема DNS балансировки
&nbsp;&nbsp;&nbsp;&nbsp;Для такого сервиса как Тик Ток был выбран тип DNS балансировки - **GeoDNS**. Принцип GeoDNS заключается в том, что ответ DNS-сервера зависит от географического местоположения источника запроса. Когда DNS-резолвер  отправляет запрос к GeoDNS-системе TikTok, система анализирует IP-адрес этого резолвера. По специальной базе данных GeoDNS определяет, из какого региона пришел запрос. На основе этого определения возвращается соответствующий этой локации IP-адрес.  


**Преимущества**:  
	1. Минимальная задержка  
	2. Эффективное распределение нагрузки  
	3. Соблюдение юрисдикций  


### Схема BGP Anycast балансировки
&nbsp;&nbsp;&nbsp;&nbsp;Если GeoDNS направляет пользователя на правильный дата-центр, то Anycast направляет его к конкретному входному узлу внутри сетевой инфраструктуры, обеспечивая еще более тонкую и быструю оптимизацию. Принцип Anycast: один и тот же IP-адрес анонсируется в интернет одновременно из нескольких, географически распределенных точек.


**Преимущества**:  
	1. Максимальная отказоустойчивость и прозрачное восстановление    
	2. Встроенная балансировка нагрузки  
	3. Снижение задержки  


## Список используемых источников:
[^1]: [Основные регионы по распространенности сервиса I](https://www.statista.com/statistics/1299807/number-of-monthly-unique-tiktok-users/), [Основные регионы по распространенности сервиса II](https://www.demandsage.com/tiktok-user-statistics/)
[^2]: [Количество зарегистрированных пользователей I](https://www.demandsage.com/tiktok-user-statistics/), [Количество зарегистрированных пользователей II](https://datareportal.com/reports/digital-2025-july-global-statshot)
[^3]: [Расположение дата-центров](https://dgtlinfra.com/tiktok-data-centers-cloud-locations/)
[^4]: [Количество активных пользователей за месяц I](https://www.statista.com/statistics/272014/global-social-networks-ranked-by-number-of-users/), [Количество активных пользователей за месяц II](https://en.wikipedia.org/wiki/List_of_social_platforms_with_at_least_100_million_active_users)
[^5]: [Количество активных пользователей за день](https://www.semrush.com/analytics/overview/?q=tiktok.com&searchType=domain&protocol=https&utm_source=explodingtopics.com&utm_medium=referral&utm_campaign=time-spent-on-tiktok)
[^6]: [Средняя продолжительность сессии](https://www.statista.com/statistics/1301075/us-daily-time-spent-social-media-platforms/)
[^7]: [Количество роликов, выкладываемых в минуту](https://www.statista.com/statistics/195140/new-user-generated-content-uploaded-by-users-per-minute/)
[^8]: [Количество роликов выпускаемых в минуту](https://www.statista.com/statistics/195140/new-user-generated-content-uploaded-by-users-per-minute/)
[^9]: [Количество скачиваний в год](https://www.statista.com/statistics/1377008/tiktok-worldwide-downloads-quarterly/)
[^10]: [Продуктовые метрики](https://www.socialinsider.io/social-media-benchmarks/tiktok)
[^11]: [Средняя продолжительность ролика](https://www.statista.com/statistics/1485205/tiktok-video-duration/)
[^12]: [Среднее количество просмотров](https://www.statista.com/statistics/1372502/tiktok-video-views-by-type-account/)
[^13]: [Среднее количество добавлений в избранное](https://www.shortformdata.com/blog/saves-are-the-secret-to-tiktok-search-ranking-in-2025)
[^14]: [Среднее количество поисков I](https://riseatseven.com/blog/tiktok-seo-statistics-in-2024/), [Среднее количество поисков II](https://www.adobe.com/express/learn/blog/using-tiktok-as-a-search-engine)
[^15]: [Отношение Duet/Stitch роликов ко всем](https://sqmagazine.co.uk/tiktok-vs-instagram-statistics/)

